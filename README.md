# 🎥📺 AdFunced-bilibili-capture / 哔哩哔哩高级截图工具

~~简称 ABC，对，这就是明目张胆地玩梗（x~~

~~鉴于 B 站并没有什么海外业务，这个 README 就不用英文写了。~~

## 📃 安装

[点击此处](https://github.com/Dwscdv3/AdFunced-bilibili-capture/raw/master/AdFunced-bilibili-capture.user.js)。

您的浏览器需要安装有 Greasemonkey 或与其兼容的用户脚本管理器扩展（如 Tampermonkey），否则将看到源代码而不是安装界面。

使用前请先查看下方的 [使用指南](#使用指南)。

## 🛠 功能

* 截图
  * 匹配源视频分辨率
  * 快速复制到剪贴板
  * 输出为 PNG 或不同质量的 JPEG
* 录制 GIF
  * 支持自定义分辨率、FPS 等参数
  * 不限时长，~~只要你的内存没爆~~
* ~~人形 TAS~~，单帧操作

### 附加功能

#### 弹幕开关

此脚本还重写了弹幕开关按钮的功能，使关闭弹幕时仍然照常绘制弹幕，以便在重新打开弹幕时能够立刻看到之前几秒的弹幕，而不是等着新弹幕从最右面慢悠悠滚出来。

~~尽管此脚本的截图功能并不能将弹幕截进去。~~

修改后的开关显示为粉色以与原版区分。

## ❔ 使用指南

目前只支持快捷键操作，没有支持 GUI 的打算。~~当然，欢迎 PR（~~

| 快捷键    | 功能                                                                                        |
|:---------:|---------------------------------------------------------------------------------------------|
| A         | 上一帧                                                                                      |
| D         | 下一帧                                                                                      |
| C         | 复制到剪贴板                                                                                |
| S         | 复制到剪贴板并以 PNG 格式保存到下载目录                                                     |
| 主数字键  | 复制到剪贴板并以 JPEG 格式保存到下载目录（左侧 1 为最低质量，右侧 0 为最高质量，推荐 4 ~ 6）|
| Z         | 标记录制起始位置（在进度条上显示标记）                                                      |
| X         | 将从标记处起到当前位置为止的内容录制为 GIF，在新标签页中打开                                |
| Ctrl+Menu | 打开设置面板（目前的设置只有 GIF 输出参数）（Menu 键是空格键右边那个阿卡林附体的 ≣ 键）     |

截图不会将弹幕截进去，无论弹幕开关当前是否打开。（弹幕截图依赖于 Canvas 渲染模式，但 pakku.js 等扩展的一些功能依赖于 CSS 渲染模式，切换到 Canvas 模式会影响到这类扩展的正常工作。因此放弃了弹幕截图支持。）

截图的分辨率为视频的原始分辨率，不受播放器视窗大小的影响。

剪贴板中始终是无损的位图，不受 JPEG 质量参数的影响。GIF 动图无法复制到剪贴板。

文件名格式为 `BV号-分钟-秒钟`，例如 `BV1rE411W7m6-21-09.png`。

## ⚠ 兼容性

剪贴板目前仅支持 Chrome 76+（包括新版 Edge），其他功能应该支持所有现代浏览器。

## 🕳 剩下的坑

按优先级排列。~~看心情，不保证会填。~~

* 选项：允许在播放时实时录制 GIF，而不是暂停后一帧一帧调进度（数倍的性能提升，但是可能导致轻微丢帧和时间不精确）
* 将 JPEG 质量参数迁移到设置面板，只保留一个快捷键
* 自定义快捷键
* 美化设置面板

## ❤ 项目依赖

* [gif.js](https://github.com/jnordberg/gif.js)
* [GM_config](https://github.com/sizzlemctwizzle/GM_config)
